{%- set internal = salt['pillar.get']('freeipa:hostname') -%}
{%- set external = salt['pillar.get']('freeipa:ui_domain') -%}

# VERSION 6 - DO NOT REMOVE THIS LINE

ProxyPassReverseCookieDomain {{ internal }} {{ external }}
RequestHeader edit Referer ^http://{{ external|replace('.', '\.') }}/ http://{{ internal }}/
RequestHeader edit Referer ^https://{{ external|replace('.', '\.') }}/ https://{{ internal }}/

RewriteEngine on

# By default forward all requests to /ipa. If you don't want IPA
# to be the default on your web server comment this line out.
RewriteRule ^/$ /ipa/ui [L,NC,R=301]

# Rewrite for plugin index, make it like it's a static file
RewriteRule ^/ipa/ui/js/freeipa/plugins.js$    /ipa/wsgi/plugins.py [PT]



# ===========================================================================
# Original FreeIPA Configuration
# ===========================================================================
#
## VERSION 6 - DO NOT REMOVE THIS LINE
#
#RewriteEngine on
#
## By default forward all requests to /ipa. If you don't want IPA
## to be the default on your web server comment this line out.
#RewriteRule ^/$ https://ipa-01.magfest.net/ipa/ui [L,NC,R=301]
#
## Redirect to the fully-qualified hostname. Not redirecting to secure
## port so configuration files can be retrieved without requiring SSL.
#RewriteCond %{HTTP_HOST}    !^ipa-01.magfest.net$ [NC]
#RewriteRule ^/ipa/(.*)      http://ipa-01.magfest.net/ipa/$1 [L,R=301]
#
## Redirect to the secure port if not displaying an error or retrieving
## configuration.
#RewriteCond %{SERVER_PORT}  !^443$
#RewriteCond %{REQUEST_URI}  !^/ipa/(errors|config|crl)
#RewriteCond %{REQUEST_URI}  !^/ipa/[^\?]+(\.js|\.css|\.png|\.gif|\.ico|\.woff|\.svg|\.ttf|\.eot)$
#RewriteRule ^/ipa/(.*)      https://ipa-01.magfest.net/ipa/$1 [L,R=301,NC]
#
## Rewrite for plugin index, make it like it's a static file
#RewriteRule ^/ipa/ui/js/freeipa/plugins.js$    /ipa/wsgi/plugins.py [PT]
